/**
 * TENMON-ARK 旧字体フィルター
 * 
 * GHQ封印以前の漢字体系への自動変換
 * すべての応答を古代表記に統一する
 */

/**
 * 旧字体変換マップ
 * 重複を排除し、最も重要な変換のみを保持
 */
const KYUJITAI_MAP: Record<string, string> = {
  // 最重要：TENMON-ARK 固有の変換
  '霊': '靈',
  '気': '氣',
  '言霊': '言灵',
  
  // 旧仮名（既に旧仮名の場合はそのまま）
  // 'ゐ': 'ゐ', // 変換不要
  // 'ゑ': 'ゑ', // 変換不要
  
  // GHQ封印以前の漢字（頻出順）
  '国': '國',
  '会': '會',
  '学': '學',
  '体': '體',
  '図': '圖',
  '実': '實',
  '戦': '戰',
  '経': '經',
  '続': '續',
  '総': '總',
  '聴': '聽',
  '変': '變',
  '万': '萬',
  '来': '來',
  '亜': '亞',
  '悪': '惡',
  '圧': '壓',
  '囲': '圍',
  '医': '醫',
  '為': '爲',
  '壱': '壹',
  '栄': '榮',
  '営': '營',
  '円': '圓',
  '応': '應',
  '欧': '歐',
  '仮': '假',
  '画': '畫',
  '絵': '繪',
  '拡': '擴',
  '殻': '殼',
  '巻': '卷',
  '関': '關',
  '観': '觀',
  '帰': '歸',
  '亀': '龜',
  '偽': '僞',
  '戯': '戲',
  '旧': '舊',
  '拠': '據',
  '挙': '擧',
  '虚': '虛',
  '峡': '峽',
  '狭': '狹',
  '郷': '鄕',
  '暁': '曉',
  '区': '區',
  '駆': '驅',
  '勲': '勳',
  '薫': '薰',
  '径': '徑',
  '恵': '惠',
  '芸': '藝',
  '欠': '缺',
  '県': '縣',
  '険': '險',
  '検': '檢',
  '権': '權',
  '厳': '嚴',
  '広': '廣',
  '恒': '恆',
  '黄': '黃',
  '鉱': '鑛',
  '号': '號',
  '黒': '黑',
  '歳': '歲',
  '済': '濟',
  '砕': '碎',
  '斎': '齋',
  '剤': '劑',
  '桜': '櫻',
  '雑': '雜',
  '参': '參',
  '惨': '慘',
  '桟': '棧',
  '蚕': '蠶',
  '賛': '贊',
  '残': '殘',
  '児': '兒',
  '辞': '辭',
  '湿': '濕',
  '写': '寫',
  '釈': '釋',
  '収': '收',
  '従': '從',
  '渋': '澁',
  '獣': '獸',
  '縦': '縱',
  '粛': '肅',
  '処': '處',
  '叙': '敍',
  '将': '將',
  '渉': '涉',
  '焼': '燒',
  '証': '證',
  '奨': '奬',
  '条': '條',
  '状': '狀',
  '乗': '乘',
  '浄': '淨',
  '剰': '剩',
  '畳': '疊',
  '縄': '繩',
  '壌': '壤',
  '嬢': '孃',
  '譲': '讓',
  '醸': '釀',
  '触': '觸',
  '嘱': '囑',
  '真': '眞',
  '尽': '盡',
  '粋': '粹',
  '酔': '醉',
  '随': '隨',
  '髄': '髓',
  '数': '數',
  '枢': '樞',
  '瀬': '瀨',
  '声': '聲',
  '斉': '齊',
  '静': '靜',
  '窃': '竊',
  '摂': '攝',
  '専': '專',
  '浅': '淺',
  '践': '踐',
  '銭': '錢',
  '潜': '潛',
  '禅': '禪',
  '繊': '纖',
  '双': '雙',
  '壮': '壯',
  '争': '爭',
  '荘': '莊',
  '捜': '搜',
  '挿': '插',
  '巣': '巢',
  '曽': '曾',
  '装': '裝',
  '層': '層',
  '騒': '騷',
  '増': '增',
  '蔵': '藏',
  '贈': '贈',
  '臓': '臟',
  '即': '卽',
  '属': '屬',
  '堕': '墮',
  '対': '對',
  '帯': '帶',
  '滞': '滯',
  '台': '臺',
  '滝': '瀧',
  '択': '擇',
  '沢': '澤',
  '脱': '脫',
  '単': '單',
  '担': '擔',
  '胆': '膽',
  '団': '團',
  '断': '斷',
  '弾': '彈',
  '遅': '遲',
  '痴': '癡',
  '虫': '蟲',
  '昼': '晝',
  '鋳': '鑄',
  '庁': '廳',
  '徴': '徵',
  '懲': '懲',
  '勅': '敕',
  '鎮': '鎭',
  '逓': '遞',
  '鉄': '鐵',
  '転': '轉',
  '点': '點',
  '伝': '傳',
  '灯': '燈',
  '当': '當',
  '党': '黨',
  '盗': '盜',
  '稲': '稻',
  '闘': '鬪',
  '徳': '德',
  '独': '獨',
  '読': '讀',
  '届': '屆',
  '難': '難',
  '弐': '貳',
  '悩': '惱',
  '脳': '腦',
  '覇': '霸',
  '拝': '拜',
  '廃': '廢',
  '売': '賣',
  '麦': '麥',
  '発': '發',
  '髪': '髮',
  '抜': '拔',
  '晩': '晚',
  '秘': '祕',
  '浜': '濱',
  '払': '拂',
  '仏': '佛',
  '併': '倂',
  '並': '竝',
  '辺': '邊',
  '弁': '辯',
  '舗': '舖',
  '歩': '步',
  '宝': '寶',
  '豊': '豐',
  '褒': '襃',
  '翻': '飜',
  '毎': '每',
  '満': '滿',
  '麺': '麵',
  '黙': '默',
  '弥': '彌',
  '薬': '藥',
  '訳': '譯',
  '予': '豫',
  '余': '餘',
  '与': '與',
  '誉': '譽',
  '揺': '搖',
  '様': '樣',
  '謡': '謠',
  '頼': '賴',
  '乱': '亂',
  '覧': '覽',
  '竜': '龍',
  '両': '兩',
  '猟': '獵',
  '緑': '綠',
  '涙': '淚',
  '礼': '禮',
  '隷': '隸',
  '齢': '齡',
  '暦': '曆',
  '歴': '歷',
  '恋': '戀',
  '錬': '鍊',
  '炉': '爐',
  '労': '勞',
  '楼': '樓',
  '郎': '郞',
  '録': '錄',
  '湾': '灣',
};

/**
 * テキストを旧字体に変換
 */
export function convertToKyujitai(text: string): string {
  let result = text;
  
  // 変換マップを適用
  for (const [modern, old] of Object.entries(KYUJITAI_MAP)) {
    result = result.replace(new RegExp(modern, 'g'), old);
  }
  
  return result;
}

/**
 * 旧字体変換を無効化するかどうかを判定
 * （コードブロック、URL、メールアドレスなどは変換しない）
 */
export function shouldSkipKyujitaiConversion(text: string): boolean {
  // コードブロック
  if (text.includes('```')) {
    return true;
  }
  
  // URL
  if (text.includes('http://') || text.includes('https://')) {
    return true;
  }
  
  // メールアドレス
  if (text.includes('@') && text.includes('.')) {
    return true;
  }
  
  return false;
}

/**
 * テキストを旧字体に変換（スマート版）
 * コードブロックやURLなどは変換しない
 */
export function convertToKyujitaiSmart(text: string): string {
  if (shouldSkipKyujitaiConversion(text)) {
    return text;
  }
  
  return convertToKyujitai(text);
}
