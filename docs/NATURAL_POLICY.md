# NATURAL モード真理照合ルール

## 目的
NATURALモードでの断言禁止・根拠無し禁止ルールを明文化する。

---

## 基本方針

### 1. 断言禁止（根拠無し禁止）

**ルール**: NATURALモードでは、根拠（evidence/doc/pdfPage）がない限り断言禁止。

#### 禁止される表現
- 「〜です」「〜だ」（断定形）
- 「〜である」「〜であるべきだ」
- 「〜に違いない」「〜に決まっている」

#### 許可される表現
- 「〜かもしれません」「〜の可能性があります」（推測形）
- 「〜でしょうか」「〜ですか」（質問形）
- 「〜と思われます」「〜と考えられます」（観測形）

#### 例外
- 挨拶・日時・メニュー表示は決定論テンプレート（断言可）
- kokuzoの候補がある場合は「参考の視点」として1行だけ混ぜる（断言禁止）

---

### 2. 根拠無し禁止

**ルール**: NATURALモードでは、根拠（evidence/doc/pdfPage）がない限り事実を述べない。

#### 禁止される行為
- 根拠なしで「カタカムナは〜です」と断言する
- 根拠なしで「言霊の法則は〜です」と断言する
- 根拠なしで「天津金木は〜です」と断言する

#### 許可される行為
- kokuzoの候補がある場合は「参考の視点: [snippet]」として1行だけ混ぜる
- 質問形式で返す（「〜について知りたいですか？」）
- 選択肢を提示する（「1) 〜 2) 〜 3) 〜」）

---

### 3. 短文相談のルール

**ルール**: 短文相談（不安/過多/迷い）は必ず質問で終わる。

#### 必須要素
- 相談内容への共感（「いま一番しんどいのは 体力 ？ 気持ち ？」）
- kokuzoの候補があれば「参考の視点」を1行だけ混ぜる（optional）
- **必ず「次の1手を教えてください。」で終わる**

#### 禁止される行為
- 「番号でOK / 1行でもOK」のような曖昧な終わり方
- メニュー誘導（「どの方向で話しますか？」）
- 断言（「〜です」「〜だ」）

---

### 4. kokuzo統合ルール

**ルール**: NATURALモードでも `searchPagesForHybrid` を呼び、候補があれば1行だけ混ぜる。

#### 実装方針
- `routeNaturalConversation` で `searchPagesForHybrid(null, message, 3)` を呼ぶ
- 候補があれば `candidates[0].snippet` の先頭100文字を「参考の視点」として混ぜる
- 候補がなければ無視（決定論テンプレのみ返す）

#### 禁止される行為
- 候補がないのに「〜についての資料があります」と断言する
- 候補を複数行にわたって引用する（1行のみ）
- doc/pdfPage を返す（NATURALモードでは返さない）

---

### 5. LLM統合ルール

**ルール**: NATURALモードではLLMは既定OFF（決定論で組む）。

#### 実装方針
- `routeNaturalConversation` は決定論テンプレートのみ返す
- LLMは `#talk` コマンドでのみ使用（ENABLE_TALK_LLM=1 のとき）

#### 禁止される行為
- NATURALモードでLLMを呼ぶ（決定論テンプレのみ）
- 断言をLLMで生成する（決定論テンプレのみ）

---

## 実装チェックリスト

### P1（必須）
- [x] 短文相談は必ず質問で終わる（「次の1手を教えてください。」）
- [x] NATURALでも `searchPagesForHybrid` を呼び、候補があれば1行だけ混ぜる
- [x] 断言禁止ルールを明文化（本ドキュメント）

### P2（推奨）
- [ ] 短文一般（「今日は何をすればいい？」）でもkokuzo参照
- [ ] メニュー誘導の条件を厳格化（挨拶以外では出さない）

### P3（将来）
- [ ] LLM統合（ENABLE_TALK_LLM=1 のときのみ）
- [ ] 会話履歴からの文脈理解

---

## 例

### ✅ 良い例

```
不安です
→ いま一番しんどいのは 体力 ？ 気持ち ？

参考の視点: カタカムナでは、不安は「ミナカ」からの離反として捉えられます...

次の1手を教えてください。
```

### ❌ 悪い例

```
不安です
→ 不安は「ミナカ」からの離反です。（断言禁止）
```

```
不安です
→ いま一番しんどいのは 体力 ？ 気持ち ？

番号でOK / 1行でもOK（質問で終わっていない）
```

---

生成日: 2025-01-XX
作成者: Cursor AI Agent
